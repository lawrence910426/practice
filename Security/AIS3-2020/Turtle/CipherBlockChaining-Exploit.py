import requests
from bs4 import BeautifulSoup
import base64
import copy

session = requests.Session()
result = session.get("https://turtowl.ais3.org/")
soup = BeautifulSoup(result.text, features="html.parser")
token = soup.find("input", {"name":"csrf_token"})['value']
print(token)

def check_valid(token):
    result = session.post("https://turtowl.ais3.org/?action=login", data={
        "csrf_token": token,
        "username": "admin",
        "password": "admin"
    })
    if result.text == '<script>; document.location.replace("\/");</script>':
        print("GOOD")
        return False
    elif 'Uncaught Exception: token decryption failed in /var/www/html/csrf.php:25' in result.text:
        return False
    elif 'invalid csrf_token' in result.text:
        return True
    else:
        print(result.text)

def convert(token):
    return base64.b64encode(bytes(token[0]) + bytes(token[1]))

token = base64.b64decode(token)
cipher = [bytearray(token[i * 16:i * 16 + 16] for i in range(4))]
plaintext = []
for chunk in range(1, 4):
    payload = bytearray(16)
    for offset in range(16):
        for i in range(offset):
            payload[15 - i] ^= offset

        for guess in range(255):
            payload[-offset] ^= guess

            payload[-offset] ^= guess

        for i in range(offset):
            payload[15 - i] ^= offset
